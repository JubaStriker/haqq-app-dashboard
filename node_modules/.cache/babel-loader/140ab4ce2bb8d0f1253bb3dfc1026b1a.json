{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.createTransportListener = exports.fromWindow = exports.fromFrame = exports.Context = void 0;\n\nvar Error_1 = require(\"./actions/Error\");\n\nvar validator_1 = require(\"./actions/validator\");\n\nvar types_1 = require(\"./client/types\");\n\nvar collection_1 = require(\"./util/collection\");\n\nvar env_1 = require(\"./util/env\");\n\nvar unframed_1 = require(\"./util/unframed\");\n\nvar Context;\n\n(function (Context) {\n  Context[\"Modal\"] = \"Modal\";\n  Context[\"Main\"] = \"Main\";\n})(Context = exports.Context || (exports.Context = {}));\n/**\n * Create a MessageTransport from an IFrame.\n * @remarks\n * Used on the host-side to create a postMessage MessageTransport.\n * @beta\n */\n\n\nfunction fromFrame(frame, localOrigin, context) {\n  var handlers = [];\n\n  if (typeof frame === 'undefined' || !frame.ownerDocument || !frame.ownerDocument.defaultView) {\n    throw Error_1.fromAction('App frame is undefined', Error_1.AppActionType.WINDOW_UNDEFINED);\n  }\n\n  var parent = frame.ownerDocument.defaultView;\n  parent.addEventListener('message', function (event) {\n    if (!validator_1.isAppMessage(event)) {\n      return;\n    }\n\n    if (event.origin !== localOrigin) {\n      var contentWindow = frame.contentWindow;\n\n      if (contentWindow) {\n        var errorMessage = \"Message origin '\" + event.origin + \"' does not match app origin '\" + localOrigin + \"'.\";\n        var payload = Error_1.invalidOriginAction(errorMessage);\n        var message = {\n          type: 'dispatch',\n          payload: payload\n        };\n        contentWindow.postMessage(message, event.origin);\n      }\n\n      return;\n    }\n\n    for (var _i = 0, handlers_1 = handlers; _i < handlers_1.length; _i++) {\n      var handler = handlers_1[_i];\n      handler(event);\n    }\n  });\n  return {\n    context: context,\n    localOrigin: localOrigin,\n    frameWindow: frame.contentWindow,\n    hostFrame: parent,\n    dispatch: function (message) {\n      var contentWindow = frame.contentWindow;\n\n      if (contentWindow) {\n        contentWindow.postMessage(message, localOrigin);\n      }\n    },\n    subscribe: function (handler) {\n      return collection_1.addAndRemoveFromCollection(handlers, handler);\n    }\n  };\n}\n\nexports.fromFrame = fromFrame;\n/**\n * Create a MessageTransport from a parent window.\n * @remarks\n * Used on the client-side to create a postMessage MessageTransport.\n * @internalremarks\n * In unframed mode, message should be dispatched via MobileWebView.postMessage instead of postMessage.\n * @beta\n */\n\nfunction fromWindow(contentWindow, localOrigin) {\n  var handlers = [];\n\n  if (typeof window !== undefined) {\n    window.addEventListener('message', function (event) {\n      if (window === contentWindow && !env_1.isUnframed || event.source !== contentWindow || !(validator_1.isAppBridgeAction(event.data.payload) || validator_1.isAppMessage(event))) {\n        return;\n      }\n\n      for (var _i = 0, handlers_2 = handlers; _i < handlers_2.length; _i++) {\n        var handler = handlers_2[_i];\n        handler(event);\n      }\n    });\n  }\n\n  return {\n    localOrigin: localOrigin,\n    hostFrame: contentWindow,\n    dispatch: function (message) {\n      var _a;\n\n      if (!((_a = message.source) === null || _a === void 0 ? void 0 : _a.host)) {\n        return;\n      }\n\n      if (env_1.isUnframed && window && window.MobileWebView) {\n        var payloadWithContext = unframed_1.parsePayloadWithContext({\n          id: 'unframed://fromClient',\n          origin: localOrigin,\n          data: message\n        });\n        window.MobileWebView.postMessage(payloadWithContext);\n        return;\n      }\n\n      var messageOrigin = new URL(\"https://\" + message.source.host).origin;\n      contentWindow.postMessage(message, messageOrigin);\n    },\n    subscribe: function (handler) {\n      return collection_1.addAndRemoveFromCollection(handlers, handler);\n    }\n  };\n}\n\nexports.fromWindow = fromWindow;\n\nfunction createTransportListener() {\n  var listeners = [];\n  var actionListeners = {};\n\n  function createSubscribeHandler(dispatcher) {\n    function subscribe() {\n      if (arguments.length < 2) {\n        // eslint-disable-next-line prefer-rest-params\n        return collection_1.addAndRemoveFromCollection(listeners, {\n          callback: arguments[0]\n        });\n      } // eslint-disable-next-line prefer-rest-params\n\n\n      var _a = Array.from(arguments),\n          type = _a[0],\n          callback = _a[1],\n          id = _a[2];\n\n      var actionCallback = {\n        callback: callback,\n        id: id\n      };\n      var payload = {\n        type: type,\n        id: id\n      };\n\n      if (!actionListeners[type]) {\n        actionListeners[type] = [];\n      }\n\n      if (dispatcher) {\n        dispatcher(types_1.MessageType.Subscribe, payload);\n      }\n\n      return collection_1.addAndRemoveFromCollection(actionListeners[type], actionCallback, function () {\n        if (dispatcher) {\n          dispatcher(types_1.MessageType.Unsubscribe, payload);\n        }\n      });\n    }\n\n    return subscribe;\n  }\n\n  return {\n    createSubscribeHandler: createSubscribeHandler,\n    handleMessage: function (message) {\n      listeners.forEach(function (listener) {\n        return listener.callback(message);\n      });\n    },\n    handleActionDispatch: function (_a) {\n      var type = _a.type,\n          payload = _a.payload;\n      var hasCallback = false;\n\n      if (actionListeners[type]) {\n        for (var _i = 0, _b = actionListeners[type]; _i < _b.length; _i++) {\n          var listener = _b[_i];\n          var id = listener.id,\n              callback = listener.callback;\n          var matchId = payload && payload.id === id;\n\n          if (matchId || !id) {\n            callback(payload);\n            hasCallback = true;\n          }\n        }\n      }\n\n      return hasCallback;\n    }\n  };\n}\n\nexports.createTransportListener = createTransportListener;","map":{"version":3,"sources":["/Users/jithendra/Desktop/Work/hbar-shop/hbar-shop-dashboard/node_modules/@shopify/app-bridge/MessageTransport.js"],"names":["Object","defineProperty","exports","value","createTransportListener","fromWindow","fromFrame","Context","Error_1","require","validator_1","types_1","collection_1","env_1","unframed_1","frame","localOrigin","context","handlers","ownerDocument","defaultView","fromAction","AppActionType","WINDOW_UNDEFINED","parent","addEventListener","event","isAppMessage","origin","contentWindow","errorMessage","payload","invalidOriginAction","message","type","postMessage","_i","handlers_1","length","handler","frameWindow","hostFrame","dispatch","subscribe","addAndRemoveFromCollection","window","undefined","isUnframed","source","isAppBridgeAction","data","handlers_2","_a","host","MobileWebView","payloadWithContext","parsePayloadWithContext","id","messageOrigin","URL","listeners","actionListeners","createSubscribeHandler","dispatcher","arguments","callback","Array","from","actionCallback","MessageType","Subscribe","Unsubscribe","handleMessage","forEach","listener","handleActionDispatch","hasCallback","_b","matchId"],"mappings":"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","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.createTransportListener = exports.fromWindow = exports.fromFrame = exports.Context = void 0;\nvar Error_1 = require(\"./actions/Error\");\nvar validator_1 = require(\"./actions/validator\");\nvar types_1 = require(\"./client/types\");\nvar collection_1 = require(\"./util/collection\");\nvar env_1 = require(\"./util/env\");\nvar unframed_1 = require(\"./util/unframed\");\nvar Context;\n(function (Context) {\n    Context[\"Modal\"] = \"Modal\";\n    Context[\"Main\"] = \"Main\";\n})(Context = exports.Context || (exports.Context = {}));\n/**\n * Create a MessageTransport from an IFrame.\n * @remarks\n * Used on the host-side to create a postMessage MessageTransport.\n * @beta\n */\nfunction fromFrame(frame, localOrigin, context) {\n    var handlers = [];\n    if (typeof frame === 'undefined' || !frame.ownerDocument || !frame.ownerDocument.defaultView) {\n        throw Error_1.fromAction('App frame is undefined', Error_1.AppActionType.WINDOW_UNDEFINED);\n    }\n    var parent = frame.ownerDocument.defaultView;\n    parent.addEventListener('message', function (event) {\n        if (!validator_1.isAppMessage(event)) {\n            return;\n        }\n        if (event.origin !== localOrigin) {\n            var contentWindow = frame.contentWindow;\n            if (contentWindow) {\n                var errorMessage = \"Message origin '\" + event.origin + \"' does not match app origin '\" + localOrigin + \"'.\";\n                var payload = Error_1.invalidOriginAction(errorMessage);\n                var message = {\n                    type: 'dispatch',\n                    payload: payload,\n                };\n                contentWindow.postMessage(message, event.origin);\n            }\n            return;\n        }\n        for (var _i = 0, handlers_1 = handlers; _i < handlers_1.length; _i++) {\n            var handler = handlers_1[_i];\n            handler(event);\n        }\n    });\n    return {\n        context: context,\n        localOrigin: localOrigin,\n        frameWindow: frame.contentWindow,\n        hostFrame: parent,\n        dispatch: function (message) {\n            var contentWindow = frame.contentWindow;\n            if (contentWindow) {\n                contentWindow.postMessage(message, localOrigin);\n            }\n        },\n        subscribe: function (handler) {\n            return collection_1.addAndRemoveFromCollection(handlers, handler);\n        },\n    };\n}\nexports.fromFrame = fromFrame;\n/**\n * Create a MessageTransport from a parent window.\n * @remarks\n * Used on the client-side to create a postMessage MessageTransport.\n * @internalremarks\n * In unframed mode, message should be dispatched via MobileWebView.postMessage instead of postMessage.\n * @beta\n */\nfunction fromWindow(contentWindow, localOrigin) {\n    var handlers = [];\n    if (typeof window !== undefined) {\n        window.addEventListener('message', function (event) {\n            if ((window === contentWindow && !env_1.isUnframed) ||\n                event.source !== contentWindow ||\n                !(validator_1.isAppBridgeAction(event.data.payload) || validator_1.isAppMessage(event))) {\n                return;\n            }\n            for (var _i = 0, handlers_2 = handlers; _i < handlers_2.length; _i++) {\n                var handler = handlers_2[_i];\n                handler(event);\n            }\n        });\n    }\n    return {\n        localOrigin: localOrigin,\n        hostFrame: contentWindow,\n        dispatch: function (message) {\n            var _a;\n            if (!((_a = message.source) === null || _a === void 0 ? void 0 : _a.host)) {\n                return;\n            }\n            if (env_1.isUnframed && window && window.MobileWebView) {\n                var payloadWithContext = unframed_1.parsePayloadWithContext({\n                    id: 'unframed://fromClient',\n                    origin: localOrigin,\n                    data: message,\n                });\n                window.MobileWebView.postMessage(payloadWithContext);\n                return;\n            }\n            var messageOrigin = new URL(\"https://\" + message.source.host).origin;\n            contentWindow.postMessage(message, messageOrigin);\n        },\n        subscribe: function (handler) {\n            return collection_1.addAndRemoveFromCollection(handlers, handler);\n        },\n    };\n}\nexports.fromWindow = fromWindow;\nfunction createTransportListener() {\n    var listeners = [];\n    var actionListeners = {};\n    function createSubscribeHandler(dispatcher) {\n        function subscribe() {\n            if (arguments.length < 2) {\n                // eslint-disable-next-line prefer-rest-params\n                return collection_1.addAndRemoveFromCollection(listeners, { callback: arguments[0] });\n            }\n            // eslint-disable-next-line prefer-rest-params\n            var _a = Array.from(arguments), type = _a[0], callback = _a[1], id = _a[2];\n            var actionCallback = { callback: callback, id: id };\n            var payload = { type: type, id: id };\n            if (!actionListeners[type]) {\n                actionListeners[type] = [];\n            }\n            if (dispatcher) {\n                dispatcher(types_1.MessageType.Subscribe, payload);\n            }\n            return collection_1.addAndRemoveFromCollection(actionListeners[type], actionCallback, function () {\n                if (dispatcher) {\n                    dispatcher(types_1.MessageType.Unsubscribe, payload);\n                }\n            });\n        }\n        return subscribe;\n    }\n    return {\n        createSubscribeHandler: createSubscribeHandler,\n        handleMessage: function (message) {\n            listeners.forEach(function (listener) { return listener.callback(message); });\n        },\n        handleActionDispatch: function (_a) {\n            var type = _a.type, payload = _a.payload;\n            var hasCallback = false;\n            if (actionListeners[type]) {\n                for (var _i = 0, _b = actionListeners[type]; _i < _b.length; _i++) {\n                    var listener = _b[_i];\n                    var id = listener.id, callback = listener.callback;\n                    var matchId = payload && payload.id === id;\n                    if (matchId || !id) {\n                        callback(payload);\n                        hasCallback = true;\n                    }\n                }\n            }\n            return hasCallback;\n        },\n    };\n}\nexports.createTransportListener = createTransportListener;\n"]},"metadata":{},"sourceType":"script"}