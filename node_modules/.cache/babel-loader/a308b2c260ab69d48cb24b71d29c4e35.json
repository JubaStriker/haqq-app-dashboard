{"ast":null,"code":"\"use strict\";\n\nexports.__esModule = true;\n\nvar tslib_1 = require(\"tslib\");\n\nvar react_1 = require(\"react\");\n\nvar util_1 = require(\"./util\");\n\nvar getInitialState = function (queryId, initialLoad) {\n  return {\n    queryId: queryId,\n    isLoading: initialLoad === undefined,\n    isLive: false,\n    isSyncing: false,\n    results: initialLoad && initialLoad.results || undefined,\n    count: initialLoad && initialLoad.count || undefined\n  };\n};\n\nvar ActionTypes;\n\n(function (ActionTypes) {\n  ActionTypes[ActionTypes[\"LoadLocalDatastoreResults\"] = 0] = \"LoadLocalDatastoreResults\";\n  ActionTypes[ActionTypes[\"SetIsLive\"] = 1] = \"SetIsLive\";\n  ActionTypes[ActionTypes[\"SetIsSyncing\"] = 2] = \"SetIsSyncing\";\n  ActionTypes[ActionTypes[\"LoadParseServerResults\"] = 3] = \"LoadParseServerResults\";\n  ActionTypes[ActionTypes[\"LoadResult\"] = 4] = \"LoadResult\";\n  ActionTypes[ActionTypes[\"UnloadResult\"] = 5] = \"UnloadResult\";\n  ActionTypes[ActionTypes[\"Fail\"] = 6] = \"Fail\";\n  ActionTypes[ActionTypes[\"Reset\"] = 7] = \"Reset\";\n})(ActionTypes || (ActionTypes = {}));\n\nvar loadLocalDatastoreResults = function (queryId, results, count) {\n  return {\n    type: ActionTypes.LoadLocalDatastoreResults,\n    payload: {\n      queryId: queryId,\n      results: results,\n      count: count\n    }\n  };\n};\n\nvar setIsLive = function (queryId, isLive) {\n  return {\n    type: ActionTypes.SetIsLive,\n    payload: {\n      queryId: queryId,\n      isLive: isLive\n    }\n  };\n};\n\nvar setIsSyncing = function (queryId, isSyncing) {\n  return {\n    type: ActionTypes.SetIsSyncing,\n    payload: {\n      queryId: queryId,\n      isSyncing: isSyncing\n    }\n  };\n};\n\nvar loadParseServerResults = function (queryId, results, count) {\n  return {\n    type: ActionTypes.LoadParseServerResults,\n    payload: {\n      queryId: queryId,\n      results: results,\n      count: count\n    }\n  };\n};\n\nvar loadResult = function (queryId, result, order, limit) {\n  return {\n    type: ActionTypes.LoadResult,\n    payload: {\n      queryId: queryId,\n      result: result,\n      order: order,\n      limit: limit\n    }\n  };\n};\n\nvar unloadResult = function (queryId, result) {\n  return {\n    type: ActionTypes.UnloadResult,\n    payload: {\n      queryId: queryId,\n      result: result\n    }\n  };\n};\n\nvar fail = function (queryId, error) {\n  return {\n    type: ActionTypes.Fail,\n    payload: {\n      queryId: queryId,\n      error: error\n    }\n  };\n};\n\nvar reset = function (initialLoad) {\n  return {\n    type: ActionTypes.Reset,\n    payload: {\n      initialLoad: initialLoad\n    }\n  };\n};\n\nvar reducer = function (state, action) {\n  if (action.type === ActionTypes.Reset) {\n    return getInitialState(state.queryId + 1, action.payload.initialLoad);\n  } else if (action.payload.queryId !== state.queryId || state.error) {\n    return state;\n  }\n\n  switch (action.type) {\n    case ActionTypes.LoadLocalDatastoreResults:\n      {\n        return (0, tslib_1.__assign)((0, tslib_1.__assign)({}, state), {\n          isLoading: false,\n          results: state.isLoading ? action.payload.results : state.results,\n          count: state.isLoading ? action.payload.count : state.count\n        });\n      }\n\n    case ActionTypes.SetIsLive:\n      {\n        return (0, tslib_1.__assign)((0, tslib_1.__assign)({}, state), {\n          isLive: action.payload.isLive\n        });\n      }\n\n    case ActionTypes.SetIsSyncing:\n      {\n        return (0, tslib_1.__assign)((0, tslib_1.__assign)({}, state), {\n          isSyncing: action.payload.isSyncing\n        });\n      }\n\n    case ActionTypes.LoadParseServerResults:\n      {\n        return (0, tslib_1.__assign)((0, tslib_1.__assign)({}, state), {\n          isLoading: false,\n          isSyncing: false,\n          results: action.payload.results,\n          count: action.payload.count\n        });\n      }\n\n    case ActionTypes.LoadResult:\n      {\n        var results = state.results;\n        var count = state.count;\n\n        if (results) {\n          results = results.filter(function (result) {\n            return result.id !== action.payload.result.id;\n          });\n          var index = 0;\n\n          if (action.payload.order) {\n            index = results.findIndex(function (result) {\n              return (0, util_1.compareParseObjects)(result, action.payload.result, action.payload.order) >= 0;\n            });\n          }\n\n          results.splice(index, 0, action.payload.result);\n\n          if (count !== undefined) {\n            count = state.count + results.length - state.results.length;\n\n            if (count < 0) {\n              count = 0;\n            }\n\n            if (count < results.length) {\n              count = results.length;\n            }\n          }\n\n          if (action.payload.limit !== undefined && action.payload.limit >= 0 && results.length > action.payload.limit) {\n            results = results.slice(0, action.payload.limit);\n          }\n        }\n\n        return (0, tslib_1.__assign)((0, tslib_1.__assign)({}, state), {\n          results: results,\n          count: count\n        });\n      }\n\n    case ActionTypes.UnloadResult:\n      {\n        var results = state.results;\n        var count = state.count;\n\n        if (results) {\n          results = results.filter(function (result) {\n            return result.id !== action.payload.result.id;\n          });\n\n          if (count !== undefined) {\n            count--;\n\n            if (count < 0) {\n              count = 0;\n            }\n\n            if (count < results.length) {\n              count = results.length;\n            }\n          }\n        }\n\n        return (0, tslib_1.__assign)((0, tslib_1.__assign)({}, state), {\n          results: results\n        });\n      }\n\n    case ActionTypes.Fail:\n      {\n        return (0, tslib_1.__assign)((0, tslib_1.__assign)({}, state), {\n          isLoading: false,\n          isLive: false,\n          isSyncing: false,\n          error: action.payload.error\n        });\n      }\n  }\n};\n\nvar useParseQuery = function (query, options) {\n  var queryString = (0, react_1.useMemo)(function () {\n    return JSON.stringify({\n      className: query.className,\n      query: query.toJSON()\n    });\n  }, [query]);\n\n  var _a = options || {},\n      _b = _a.enabled,\n      enabled = _b === void 0 ? true : _b,\n      _c = _a.enableLocalDatastore,\n      enableLocalDatastore = _c === void 0 ? true : _c,\n      _d = _a.enableLiveQuery,\n      enableLiveQuery = _d === void 0 ? true : _d,\n      initialLoad = _a.initialLoad;\n\n  var _e = initialLoad || {},\n      initialResults = _e.results,\n      initialCount = _e.count;\n\n  var stateRef = (0, react_1.useRef)(getInitialState(1, initialLoad));\n\n  var _f = (0, react_1.useReducer)(function (state, action) {\n    stateRef.current = reducer(state, action);\n    return stateRef.current;\n  }, stateRef.current),\n      _g = _f[0],\n      queryId = _g.queryId,\n      isLoading = _g.isLoading,\n      isLive = _g.isLive,\n      isSyncing = _g.isSyncing,\n      results = _g.results,\n      count = _g.count,\n      error = _g.error,\n      dispatch = _f[1];\n\n  var localDatastoreQuery = (0, react_1.useMemo)(function () {\n    if (enableLocalDatastore) {\n      var queryJSON = JSON.parse(queryString);\n      var memoedQuery = Parse.Query.fromJSON(queryJSON.className, queryJSON.query);\n      memoedQuery.fromPinWithName(queryString);\n      return memoedQuery;\n    }\n\n    return;\n  }, [queryString, enableLocalDatastore]);\n  var findFromLocalDatastore = (0, react_1.useCallback)(function () {\n    return (0, tslib_1.__awaiter)(void 0, void 0, void 0, function () {\n      var findResult, e_1;\n      return (0, tslib_1.__generator)(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            _a.trys.push([0, 2,, 3]);\n\n            return [4\n            /*yield*/\n            , localDatastoreQuery.find()];\n\n          case 1:\n            findResult = _a.sent();\n            return [3\n            /*break*/\n            , 3];\n\n          case 2:\n            e_1 = _a.sent();\n            dispatch(fail(queryId, e_1));\n            return [2\n            /*return*/\n            ];\n\n          case 3:\n            if (localDatastoreQuery._count) {\n              dispatch(loadLocalDatastoreResults(queryId, findResult.results, findResult.count));\n            } else {\n              dispatch(loadLocalDatastoreResults(queryId, findResult));\n            }\n\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  }, [queryId, localDatastoreQuery]);\n  var parseServerQuery = (0, react_1.useMemo)(function () {\n    var queryJSON = JSON.parse(queryString);\n    return Parse.Query.fromJSON(queryJSON.className, queryJSON.query);\n  }, [queryString]);\n  var pinResults = (0, react_1.useCallback)(function (results) {\n    return (0, tslib_1.__awaiter)(void 0, void 0, void 0, function () {\n      var e_2;\n      return (0, tslib_1.__generator)(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            _a.trys.push([0, 3,, 4]);\n\n            return [4\n            /*yield*/\n            , Parse.Object.unPinAllObjectsWithName(queryString)];\n\n          case 1:\n            _a.sent();\n\n            return [4\n            /*yield*/\n            , Parse.Object.pinAllWithName(queryString, results)];\n\n          case 2:\n            _a.sent();\n\n            return [3\n            /*break*/\n            , 4];\n\n          case 3:\n            e_2 = _a.sent();\n            dispatch(fail(queryId, e_2));\n            return [3\n            /*break*/\n            , 4];\n\n          case 4:\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  }, [queryString, queryId]);\n  var findFromParseServer = (0, react_1.useCallback)(function () {\n    var isCanceled = false;\n    var attempts = 1;\n\n    var find = function () {\n      return (0, tslib_1.__awaiter)(void 0, void 0, void 0, function () {\n        var findResult, e_3, results, count;\n        return (0, tslib_1.__generator)(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              if (enableLocalDatastore || enableLiveQuery || initialResults) {\n                dispatch(setIsSyncing(queryId, true));\n              }\n\n              _a.label = 1;\n\n            case 1:\n              _a.trys.push([1, 3,, 4]);\n\n              return [4\n              /*yield*/\n              , parseServerQuery.find()];\n\n            case 2:\n              findResult = _a.sent();\n              return [3\n              /*break*/\n              , 4];\n\n            case 3:\n              e_3 = _a.sent();\n\n              if (e_3 instanceof Parse.Error && e_3.code === Parse.Error.CONNECTION_FAILED) {\n                if (!isCanceled) {\n                  setTimeout(function () {\n                    if (!isCanceled) {\n                      attempts++;\n                      find();\n                    }\n                  }, Math.random() * Math.min(30, Math.pow(2, attempts) - 1) * 1000);\n                }\n              } else {\n                dispatch(fail(queryId, e_3));\n              }\n\n              return [2\n              /*return*/\n              ];\n\n            case 4:\n              results = findResult;\n\n              if (parseServerQuery._count) {\n                results = findResult.results;\n                count = findResult.count;\n              }\n\n              dispatch(loadParseServerResults(queryId, results, count));\n              if (!enableLocalDatastore) return [3\n              /*break*/\n              , 6];\n              return [4\n              /*yield*/\n              , pinResults(results)];\n\n            case 5:\n              _a.sent();\n\n              _a.label = 6;\n\n            case 6:\n              return [2\n              /*return*/\n              ];\n          }\n        });\n      });\n    };\n\n    var cancel = function () {\n      isCanceled = true;\n    };\n\n    find();\n    return cancel;\n  }, [enableLocalDatastore, enableLiveQuery, initialResults, queryId, parseServerQuery, pinResults]);\n  var subscribeLiveQuery = (0, react_1.useCallback)(function () {\n    var liveQuerySubscription;\n    var cancelFindFromParseServer;\n\n    var loadAndPinResult = function (result) {\n      return (0, tslib_1.__awaiter)(void 0, void 0, void 0, function () {\n        var e_4;\n        return (0, tslib_1.__generator)(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              dispatch(loadResult(queryId, result, parseServerQuery._order, parseServerQuery._limit));\n              if (!enableLocalDatastore) return [3\n              /*break*/\n              , 4];\n              _a.label = 1;\n\n            case 1:\n              _a.trys.push([1, 3,, 4]);\n\n              return [4\n              /*yield*/\n              , result.pinWithName(queryString)];\n\n            case 2:\n              _a.sent();\n\n              return [3\n              /*break*/\n              , 4];\n\n            case 3:\n              e_4 = _a.sent();\n              dispatch(fail(queryId, e_4));\n              return [3\n              /*break*/\n              , 4];\n\n            case 4:\n              return [2\n              /*return*/\n              ];\n          }\n        });\n      });\n    };\n\n    var unloadAndUnPinResult = function (result) {\n      return (0, tslib_1.__awaiter)(void 0, void 0, void 0, function () {\n        var e_5;\n        return (0, tslib_1.__generator)(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              dispatch(unloadResult(queryId, result));\n\n              if (parseServerQuery._limit !== undefined && parseServerQuery._limit >= 0 && stateRef.current.results && stateRef.current.results.length + 1 === parseServerQuery._limit) {\n                if (cancelFindFromParseServer) {\n                  cancelFindFromParseServer();\n                }\n\n                cancelFindFromParseServer = findFromParseServer();\n              }\n\n              if (!enableLocalDatastore) return [3\n              /*break*/\n              , 4];\n              _a.label = 1;\n\n            case 1:\n              _a.trys.push([1, 3,, 4]);\n\n              return [4\n              /*yield*/\n              , result.unPinWithName(queryString)];\n\n            case 2:\n              _a.sent();\n\n              return [3\n              /*break*/\n              , 4];\n\n            case 3:\n              e_5 = _a.sent();\n              dispatch(fail(queryId, e_5));\n              return [3\n              /*break*/\n              , 4];\n\n            case 4:\n              return [2\n              /*return*/\n              ];\n          }\n        });\n      });\n    };\n\n    var subscribe = function () {\n      return (0, tslib_1.__awaiter)(void 0, void 0, void 0, function () {\n        var e_6;\n        return (0, tslib_1.__generator)(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              _a.trys.push([0, 2,, 3]);\n\n              return [4\n              /*yield*/\n              , parseServerQuery.subscribe()];\n\n            case 1:\n              liveQuerySubscription = _a.sent();\n              return [3\n              /*break*/\n              , 3];\n\n            case 2:\n              e_6 = _a.sent();\n              dispatch(fail(queryId, e_6));\n              return [2\n              /*return*/\n              ];\n\n            case 3:\n              liveQuerySubscription.on('open', function () {\n                dispatch(setIsLive(queryId, true));\n\n                if (cancelFindFromParseServer) {\n                  cancelFindFromParseServer();\n                }\n\n                cancelFindFromParseServer = findFromParseServer();\n              });\n              liveQuerySubscription.on('close', function () {\n                dispatch(setIsLive(queryId, false));\n              });\n              liveQuerySubscription.on('create', function (result) {\n                return loadAndPinResult(result);\n              });\n              liveQuerySubscription.on('update', function (result) {\n                return loadAndPinResult(result);\n              });\n              liveQuerySubscription.on('enter', function (result) {\n                return loadAndPinResult(result);\n              });\n              liveQuerySubscription.on('leave', function (result) {\n                return unloadAndUnPinResult(result);\n              });\n              liveQuerySubscription.on('delete', function (result) {\n                return unloadAndUnPinResult(result);\n              });\n              return [2\n              /*return*/\n              ];\n          }\n        });\n      });\n    };\n\n    var subscribePromise = subscribe();\n\n    var unsubscribe = function () {\n      return (0, tslib_1.__awaiter)(void 0, void 0, void 0, function () {\n        return (0, tslib_1.__generator)(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              if (cancelFindFromParseServer) {\n                cancelFindFromParseServer();\n              }\n\n              return [4\n              /*yield*/\n              , subscribePromise];\n\n            case 1:\n              _a.sent();\n\n              if (liveQuerySubscription) {\n                liveQuerySubscription.unsubscribe();\n              }\n\n              dispatch(setIsLive(queryId, false));\n              return [2\n              /*return*/\n              ];\n          }\n        });\n      });\n    };\n\n    return unsubscribe;\n  }, [queryString, enableLocalDatastore, queryId, parseServerQuery, findFromParseServer]);\n  (0, react_1.useEffect)(function () {\n    var cleanUp;\n\n    if (enabled) {\n      if (enableLocalDatastore) {\n        if (initialResults) {\n          pinResults(initialResults);\n        } else {\n          findFromLocalDatastore();\n        }\n      }\n\n      if (enableLiveQuery) {\n        cleanUp = subscribeLiveQuery();\n      } else {\n        cleanUp = findFromParseServer();\n      }\n    }\n\n    return cleanUp;\n  }, [queryId]);\n  var reload = (0, react_1.useCallback)(function () {\n    dispatch(reset(initialLoad));\n  }, [initialResults, initialCount]);\n  (0, react_1.useEffect)(function () {\n    return reload;\n  }, [queryString, enabled, enableLocalDatastore, enableLiveQuery, initialResults, initialCount]);\n  return (0, react_1.useMemo)(function () {\n    return {\n      isLoading: isLoading,\n      isLive: isLive,\n      isSyncing: isSyncing,\n      results: results,\n      count: count,\n      error: error,\n      reload: reload\n    };\n  }, [isLoading, isLive, isSyncing, results, count, error, reload]);\n};\n\nexports[\"default\"] = useParseQuery;","map":{"version":3,"mappings":"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","names":["getInitialState","queryId","initialLoad","isLoading","undefined","isLive","isSyncing","results","count","ActionTypes","loadLocalDatastoreResults","type","LoadLocalDatastoreResults","payload","setIsLive","SetIsLive","setIsSyncing","SetIsSyncing","loadParseServerResults","LoadParseServerResults","loadResult","result","order","limit","LoadResult","unloadResult","UnloadResult","fail","error","Fail","reset","Reset","reducer","state","action","filter","id","index","findIndex","splice","length","slice","useParseQuery","query","options","queryString","JSON","stringify","className","toJSON","_b","enabled","_c","enableLocalDatastore","_d","enableLiveQuery","initialResults","initialCount","stateRef","current","_g","dispatch","localDatastoreQuery","queryJSON","parse","memoedQuery","Parse","Query","fromJSON","fromPinWithName","findFromLocalDatastore","find","findResult","_a","e_1","_count","parseServerQuery","pinResults","Object","unPinAllObjectsWithName","pinAllWithName","e_2","findFromParseServer","isCanceled","attempts","e_3","Error","code","CONNECTION_FAILED","setTimeout","Math","random","min","pow","cancel","subscribeLiveQuery","liveQuerySubscription","cancelFindFromParseServer","loadAndPinResult","_order","_limit","pinWithName","e_4","unloadAndUnPinResult","unPinWithName","e_5","subscribe","e_6","on","subscribePromise","unsubscribe","cleanUp","reload","exports"],"sourceRoot":"","sources":["../src/useParseQuery.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}