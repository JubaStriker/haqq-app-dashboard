{"ast":null,"code":"/*-\n * ‌\n * Hedera JavaScript SDK\n * ​\n * Copyright (C) 2020 - 2022 Hedera Hashgraph, LLC\n * ​\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * ‍\n */\nimport Query, { QUERY_REGISTRY } from \"../query/Query.js\";\nimport Status from \"../Status.js\";\nimport TransactionReceipt from \"./TransactionReceipt.js\";\nimport TransactionId from \"./TransactionId.js\";\nimport PrecheckStatusError from \"../PrecheckStatusError.js\";\nimport ReceiptStatusError from \"../ReceiptStatusError.js\";\nimport { ExecutionState } from \"../Executable.js\";\nimport Logger from \"js-logger\";\nimport * as HashgraphProto from \"@hashgraph/proto\";\nconst {\n  proto\n} = HashgraphProto;\n/**\n * @typedef {import(\"../account/AccountId.js\").default} AccountId\n * @typedef {import(\"../channel/Channel.js\").default} Channel\n * @typedef {import(\"../client/Client.js\").default<*, *>} Client\n */\n\n/**\n * @augments {Query<TransactionReceipt>}\n */\n\nexport default class TransactionReceiptQuery extends Query {\n  /**\n   * @param {object} [props]\n   * @param {TransactionId | string} [props.transactionId]\n   * @param {boolean} [props.includeDuplicates]\n   * @param {boolean} [props.includeChildren]\n   */\n  constructor() {\n    let props = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    super();\n    /**\n     * @private\n     * @type {?TransactionId}\n     */\n\n    this._transactionId = null;\n    /**\n     * @private\n     * @type {?boolean}\n     */\n\n    this._includeChildren = null;\n    /**\n     * @private\n     * @type {?boolean}\n     */\n\n    this._includeDuplicates = null;\n\n    if (props.transactionId != null) {\n      this.setTransactionId(props.transactionId);\n    }\n\n    if (props.includeChildren != null) {\n      this.setIncludeChildren(props.includeChildren);\n    }\n\n    if (props.includeDuplicates != null) {\n      this.setIncludeDuplicates(props.includeDuplicates);\n    }\n  }\n  /**\n   * @internal\n   * @param {HashgraphProto.proto.IQuery} query\n   * @returns {TransactionReceiptQuery}\n   */\n\n\n  static _fromProtobuf(query) {\n    const receipt =\n    /** @type {HashgraphProto.proto.ITransactionGetReceiptQuery} */\n    query.transactionGetReceipt;\n    return new TransactionReceiptQuery({\n      transactionId: receipt.transactionID ? TransactionId._fromProtobuf(receipt.transactionID) : undefined,\n      includeDuplicates: receipt.includeDuplicates != null ? receipt.includeDuplicates : undefined,\n      includeChildren: receipt.includeChildReceipts != null ? receipt.includeChildReceipts : undefined\n    });\n  }\n  /**\n   * @returns {?TransactionId}\n   */\n\n\n  get transactionId() {\n    return this._transactionId;\n  }\n  /**\n   * Set the transaction ID for which the receipt is being requested.\n   *\n   * @param {TransactionId | string} transactionId\n   * @returns {this}\n   */\n\n\n  setTransactionId(transactionId) {\n    this._transactionId = typeof transactionId === \"string\" ? TransactionId.fromString(transactionId) : transactionId.clone();\n    return this;\n  }\n  /**\n   * @param {boolean} includeDuplicates\n   * @returns {TransactionReceiptQuery}\n   */\n\n\n  setIncludeDuplicates(includeDuplicates) {\n    this._includeDuplicates = includeDuplicates;\n    return this;\n  }\n  /**\n   * @returns {boolean}\n   */\n\n\n  get includeDuplicates() {\n    return this._includeDuplicates != null ? this._includeDuplicates : false;\n  }\n  /**\n   * @param {boolean} includeChildren\n   * @returns {TransactionReceiptQuery}\n   */\n\n\n  setIncludeChildren(includeChildren) {\n    this._includeChildren = includeChildren;\n    return this;\n  }\n  /**\n   * @returns {boolean}\n   */\n\n\n  get includeChildren() {\n    return this._includeChildren != null ? this._includeChildren : false;\n  }\n  /**\n   * @override\n   * @protected\n   * @returns {boolean}\n   */\n\n\n  _isPaymentRequired() {\n    return false;\n  }\n  /**\n   * @override\n   * @internal\n   * @param {HashgraphProto.proto.IQuery} request\n   * @param {HashgraphProto.proto.IResponse} response\n   * @returns {[Status, ExecutionState]}\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n\n\n  _shouldRetry(request, response) {\n    const {\n      nodeTransactionPrecheckCode\n    } = this._mapResponseHeader(response);\n\n    let status = Status._fromCode(nodeTransactionPrecheckCode != null ? nodeTransactionPrecheckCode : proto.ResponseCodeEnum.OK);\n\n    Logger.debug(`[${this._getLogId()}] received node precheck status ${status.toString()}`);\n\n    switch (status) {\n      case Status.Busy:\n      case Status.Unknown:\n      case Status.ReceiptNotFound:\n        return [status, ExecutionState.Retry];\n\n      case Status.Ok:\n        break;\n\n      default:\n        return [status, ExecutionState.Error];\n    }\n\n    const transactionGetReceipt =\n    /** @type {HashgraphProto.proto.ITransactionGetReceiptResponse} */\n    response.transactionGetReceipt;\n    const receipt =\n    /** @type {HashgraphProto.proto.ITransactionReceipt} */\n    transactionGetReceipt.receipt;\n    const receiptStatusCode =\n    /** @type {HashgraphProto.proto.ResponseCodeEnum} */\n    receipt.status;\n    status = Status._fromCode(receiptStatusCode);\n    Logger.debug(`[${this._getLogId()}] received receipt status ${status.toString()}`);\n\n    switch (status) {\n      case Status.Busy:\n      case Status.Unknown:\n      case Status.ReceiptNotFound:\n        return [status, ExecutionState.Retry];\n\n      case Status.Success:\n        return [status, ExecutionState.Finished];\n\n      default:\n        return [status, ExecutionState.Error];\n    }\n  }\n  /**\n   * @returns {TransactionId}\n   */\n\n\n  _getTransactionId() {\n    if (this._transactionId != null) {\n      return this._transactionId;\n    }\n\n    return super._getTransactionId();\n  }\n  /**\n   * @override\n   * @internal\n   * @param {HashgraphProto.proto.IQuery} request\n   * @param {HashgraphProto.proto.IResponse} response\n   * @returns {Error}\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n\n\n  _mapStatusError(request, response) {\n    const {\n      nodeTransactionPrecheckCode\n    } = this._mapResponseHeader(response);\n\n    let status = Status._fromCode(nodeTransactionPrecheckCode != null ? nodeTransactionPrecheckCode : proto.ResponseCodeEnum.OK);\n\n    switch (status) {\n      case Status.Ok:\n        // Do nothing\n        break;\n\n      default:\n        return new PrecheckStatusError({\n          status,\n          transactionId: this._getTransactionId()\n        });\n    }\n\n    const transactionGetReceipt =\n    /** @type {HashgraphProto.proto.ITransactionGetReceiptResponse} */\n    response.transactionGetReceipt;\n    const receipt =\n    /** @type {HashgraphProto.proto.ITransactionReceipt} */\n    transactionGetReceipt.receipt;\n    const receiptStatusCode =\n    /** @type {HashgraphProto.proto.ResponseCodeEnum} */\n    receipt.status;\n    status = Status._fromCode(receiptStatusCode);\n\n    if (this._transactionId == null) {\n      throw new Error(\"Failed to construct `ReceiptStatusError` because `transactionId` is `null`\");\n    }\n\n    return new ReceiptStatusError({\n      status,\n      transactionId: this._transactionId,\n      transactionReceipt: TransactionReceipt._fromProtobuf(transactionGetReceipt)\n    });\n  }\n  /**\n   * @param {Client} client\n   */\n\n\n  _validateChecksums(client) {\n    if (this._transactionId != null && this._transactionId.accountId != null) {\n      this._transactionId.accountId.validateChecksum(client);\n    }\n  }\n  /**\n   * @override\n   * @internal\n   * @param {Channel} channel\n   * @param {HashgraphProto.proto.IQuery} request\n   * @returns {Promise<HashgraphProto.proto.IResponse>}\n   */\n\n\n  _execute(channel, request) {\n    return channel.crypto.getTransactionReceipts(request);\n  }\n  /**\n   * @override\n   * @internal\n   * @param {HashgraphProto.proto.IResponse} response\n   * @returns {HashgraphProto.proto.IResponseHeader}\n   */\n\n\n  _mapResponseHeader(response) {\n    const transactionGetReceipt =\n    /** @type {HashgraphProto.proto.ITransactionGetReceiptResponse} */\n    response.transactionGetReceipt;\n    return (\n      /** @type {HashgraphProto.proto.IResponseHeader} */\n      transactionGetReceipt.header\n    );\n  }\n  /**\n   * @protected\n   * @override\n   * @param {HashgraphProto.proto.IResponse} response\n   * @param {AccountId} nodeAccountId\n   * @param {HashgraphProto.proto.IQuery} request\n   * @returns {Promise<TransactionReceipt>}\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n\n\n  _mapResponse(response, nodeAccountId, request) {\n    const transactionGetReceipt =\n    /** @type {HashgraphProto.proto.ITransactionGetReceiptResponse} */\n    response.transactionGetReceipt;\n    return Promise.resolve(TransactionReceipt._fromProtobuf(transactionGetReceipt));\n  }\n  /**\n   * @override\n   * @internal\n   * @param {HashgraphProto.proto.IQueryHeader} header\n   * @returns {HashgraphProto.proto.IQuery}\n   */\n\n\n  _onMakeRequest(header) {\n    return {\n      transactionGetReceipt: {\n        header,\n        transactionID: this._transactionId != null ? this._transactionId._toProtobuf() : null,\n        includeDuplicates: this._includeDuplicates,\n        includeChildReceipts: this._includeChildren\n      }\n    };\n  }\n  /**\n   * @returns {string}\n   */\n\n\n  _getLogId() {\n    return `TransactionReceiptQuery:${this._timestamp.toString()}`;\n  }\n\n}\nQUERY_REGISTRY.set(\"transactionGetReceipt\", // eslint-disable-next-line @typescript-eslint/unbound-method\nTransactionReceiptQuery._fromProtobuf);","map":{"version":3,"sources":["/Users/jithendra/Desktop/Work/hbar-shop/hbar-shopify-coupon-client/node_modules/@hashgraph/sdk/src/transaction/TransactionReceiptQuery.js"],"names":["Query","QUERY_REGISTRY","Status","TransactionReceipt","TransactionId","PrecheckStatusError","ReceiptStatusError","ExecutionState","Logger","HashgraphProto","proto","TransactionReceiptQuery","constructor","props","_transactionId","_includeChildren","_includeDuplicates","transactionId","setTransactionId","includeChildren","setIncludeChildren","includeDuplicates","setIncludeDuplicates","_fromProtobuf","query","receipt","transactionGetReceipt","transactionID","undefined","includeChildReceipts","fromString","clone","_isPaymentRequired","_shouldRetry","request","response","nodeTransactionPrecheckCode","_mapResponseHeader","status","_fromCode","ResponseCodeEnum","OK","debug","_getLogId","toString","Busy","Unknown","ReceiptNotFound","Retry","Ok","Error","receiptStatusCode","Success","Finished","_getTransactionId","_mapStatusError","transactionReceipt","_validateChecksums","client","accountId","validateChecksum","_execute","channel","crypto","getTransactionReceipts","header","_mapResponse","nodeAccountId","Promise","resolve","_onMakeRequest","_toProtobuf","_timestamp","set"],"mappings":"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","sourcesContent":["/*-\n * ‌\n * Hedera JavaScript SDK\n * ​\n * Copyright (C) 2020 - 2022 Hedera Hashgraph, LLC\n * ​\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * ‍\n */\n\nimport Query, { QUERY_REGISTRY } from \"../query/Query.js\";\nimport Status from \"../Status.js\";\nimport TransactionReceipt from \"./TransactionReceipt.js\";\nimport TransactionId from \"./TransactionId.js\";\nimport PrecheckStatusError from \"../PrecheckStatusError.js\";\nimport ReceiptStatusError from \"../ReceiptStatusError.js\";\nimport { ExecutionState } from \"../Executable.js\";\nimport Logger from \"js-logger\";\nimport * as HashgraphProto from \"@hashgraph/proto\";\n\nconst { proto } = HashgraphProto;\n\n/**\n * @typedef {import(\"../account/AccountId.js\").default} AccountId\n * @typedef {import(\"../channel/Channel.js\").default} Channel\n * @typedef {import(\"../client/Client.js\").default<*, *>} Client\n */\n\n/**\n * @augments {Query<TransactionReceipt>}\n */\nexport default class TransactionReceiptQuery extends Query {\n    /**\n     * @param {object} [props]\n     * @param {TransactionId | string} [props.transactionId]\n     * @param {boolean} [props.includeDuplicates]\n     * @param {boolean} [props.includeChildren]\n     */\n    constructor(props = {}) {\n        super();\n\n        /**\n         * @private\n         * @type {?TransactionId}\n         */\n        this._transactionId = null;\n\n        /**\n         * @private\n         * @type {?boolean}\n         */\n        this._includeChildren = null;\n\n        /**\n         * @private\n         * @type {?boolean}\n         */\n        this._includeDuplicates = null;\n\n        if (props.transactionId != null) {\n            this.setTransactionId(props.transactionId);\n        }\n\n        if (props.includeChildren != null) {\n            this.setIncludeChildren(props.includeChildren);\n        }\n\n        if (props.includeDuplicates != null) {\n            this.setIncludeDuplicates(props.includeDuplicates);\n        }\n    }\n\n    /**\n     * @internal\n     * @param {HashgraphProto.proto.IQuery} query\n     * @returns {TransactionReceiptQuery}\n     */\n    static _fromProtobuf(query) {\n        const receipt =\n            /** @type {HashgraphProto.proto.ITransactionGetReceiptQuery} */ (\n                query.transactionGetReceipt\n            );\n\n        return new TransactionReceiptQuery({\n            transactionId: receipt.transactionID\n                ? TransactionId._fromProtobuf(receipt.transactionID)\n                : undefined,\n            includeDuplicates:\n                receipt.includeDuplicates != null\n                    ? receipt.includeDuplicates\n                    : undefined,\n            includeChildren:\n                receipt.includeChildReceipts != null\n                    ? receipt.includeChildReceipts\n                    : undefined,\n        });\n    }\n\n    /**\n     * @returns {?TransactionId}\n     */\n    get transactionId() {\n        return this._transactionId;\n    }\n\n    /**\n     * Set the transaction ID for which the receipt is being requested.\n     *\n     * @param {TransactionId | string} transactionId\n     * @returns {this}\n     */\n    setTransactionId(transactionId) {\n        this._transactionId =\n            typeof transactionId === \"string\"\n                ? TransactionId.fromString(transactionId)\n                : transactionId.clone();\n\n        return this;\n    }\n\n    /**\n     * @param {boolean} includeDuplicates\n     * @returns {TransactionReceiptQuery}\n     */\n    setIncludeDuplicates(includeDuplicates) {\n        this._includeDuplicates = includeDuplicates;\n        return this;\n    }\n\n    /**\n     * @returns {boolean}\n     */\n    get includeDuplicates() {\n        return this._includeDuplicates != null\n            ? this._includeDuplicates\n            : false;\n    }\n\n    /**\n     * @param {boolean} includeChildren\n     * @returns {TransactionReceiptQuery}\n     */\n    setIncludeChildren(includeChildren) {\n        this._includeChildren = includeChildren;\n        return this;\n    }\n\n    /**\n     * @returns {boolean}\n     */\n    get includeChildren() {\n        return this._includeChildren != null ? this._includeChildren : false;\n    }\n\n    /**\n     * @override\n     * @protected\n     * @returns {boolean}\n     */\n    _isPaymentRequired() {\n        return false;\n    }\n\n    /**\n     * @override\n     * @internal\n     * @param {HashgraphProto.proto.IQuery} request\n     * @param {HashgraphProto.proto.IResponse} response\n     * @returns {[Status, ExecutionState]}\n     */\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    _shouldRetry(request, response) {\n        const { nodeTransactionPrecheckCode } =\n            this._mapResponseHeader(response);\n\n        let status = Status._fromCode(\n            nodeTransactionPrecheckCode != null\n                ? nodeTransactionPrecheckCode\n                : proto.ResponseCodeEnum.OK\n        );\n\n        Logger.debug(\n            `[${this._getLogId()}] received node precheck status ${status.toString()}`\n        );\n\n        switch (status) {\n            case Status.Busy:\n            case Status.Unknown:\n            case Status.ReceiptNotFound:\n                return [status, ExecutionState.Retry];\n            case Status.Ok:\n                break;\n            default:\n                return [status, ExecutionState.Error];\n        }\n\n        const transactionGetReceipt =\n            /** @type {HashgraphProto.proto.ITransactionGetReceiptResponse} */ (\n                response.transactionGetReceipt\n            );\n        const receipt =\n            /** @type {HashgraphProto.proto.ITransactionReceipt} */ (\n                transactionGetReceipt.receipt\n            );\n        const receiptStatusCode =\n            /** @type {HashgraphProto.proto.ResponseCodeEnum} */ (\n                receipt.status\n            );\n\n        status = Status._fromCode(receiptStatusCode);\n\n        Logger.debug(\n            `[${this._getLogId()}] received receipt status ${status.toString()}`\n        );\n\n        switch (status) {\n            case Status.Busy:\n            case Status.Unknown:\n            case Status.ReceiptNotFound:\n                return [status, ExecutionState.Retry];\n            case Status.Success:\n                return [status, ExecutionState.Finished];\n            default:\n                return [status, ExecutionState.Error];\n        }\n    }\n\n    /**\n     * @returns {TransactionId}\n     */\n    _getTransactionId() {\n        if (this._transactionId != null) {\n            return this._transactionId;\n        }\n\n        return super._getTransactionId();\n    }\n\n    /**\n     * @override\n     * @internal\n     * @param {HashgraphProto.proto.IQuery} request\n     * @param {HashgraphProto.proto.IResponse} response\n     * @returns {Error}\n     */\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    _mapStatusError(request, response) {\n        const { nodeTransactionPrecheckCode } =\n            this._mapResponseHeader(response);\n\n        let status = Status._fromCode(\n            nodeTransactionPrecheckCode != null\n                ? nodeTransactionPrecheckCode\n                : proto.ResponseCodeEnum.OK\n        );\n\n        switch (status) {\n            case Status.Ok:\n                // Do nothing\n                break;\n\n            default:\n                return new PrecheckStatusError({\n                    status,\n                    transactionId: this._getTransactionId(),\n                });\n        }\n\n        const transactionGetReceipt =\n            /** @type {HashgraphProto.proto.ITransactionGetReceiptResponse} */ (\n                response.transactionGetReceipt\n            );\n        const receipt =\n            /** @type {HashgraphProto.proto.ITransactionReceipt} */ (\n                transactionGetReceipt.receipt\n            );\n        const receiptStatusCode =\n            /** @type {HashgraphProto.proto.ResponseCodeEnum} */ (\n                receipt.status\n            );\n\n        status = Status._fromCode(receiptStatusCode);\n\n        if (this._transactionId == null) {\n            throw new Error(\n                \"Failed to construct `ReceiptStatusError` because `transactionId` is `null`\"\n            );\n        }\n\n        return new ReceiptStatusError({\n            status,\n            transactionId: this._transactionId,\n            transactionReceipt: TransactionReceipt._fromProtobuf(\n                transactionGetReceipt\n            ),\n        });\n    }\n\n    /**\n     * @param {Client} client\n     */\n    _validateChecksums(client) {\n        if (\n            this._transactionId != null &&\n            this._transactionId.accountId != null\n        ) {\n            this._transactionId.accountId.validateChecksum(client);\n        }\n    }\n\n    /**\n     * @override\n     * @internal\n     * @param {Channel} channel\n     * @param {HashgraphProto.proto.IQuery} request\n     * @returns {Promise<HashgraphProto.proto.IResponse>}\n     */\n    _execute(channel, request) {\n        return channel.crypto.getTransactionReceipts(request);\n    }\n\n    /**\n     * @override\n     * @internal\n     * @param {HashgraphProto.proto.IResponse} response\n     * @returns {HashgraphProto.proto.IResponseHeader}\n     */\n    _mapResponseHeader(response) {\n        const transactionGetReceipt =\n            /** @type {HashgraphProto.proto.ITransactionGetReceiptResponse} */ (\n                response.transactionGetReceipt\n            );\n        return /** @type {HashgraphProto.proto.IResponseHeader} */ (\n            transactionGetReceipt.header\n        );\n    }\n\n    /**\n     * @protected\n     * @override\n     * @param {HashgraphProto.proto.IResponse} response\n     * @param {AccountId} nodeAccountId\n     * @param {HashgraphProto.proto.IQuery} request\n     * @returns {Promise<TransactionReceipt>}\n     */\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    _mapResponse(response, nodeAccountId, request) {\n        const transactionGetReceipt =\n            /** @type {HashgraphProto.proto.ITransactionGetReceiptResponse} */ (\n                response.transactionGetReceipt\n            );\n\n        return Promise.resolve(\n            TransactionReceipt._fromProtobuf(transactionGetReceipt)\n        );\n    }\n\n    /**\n     * @override\n     * @internal\n     * @param {HashgraphProto.proto.IQueryHeader} header\n     * @returns {HashgraphProto.proto.IQuery}\n     */\n    _onMakeRequest(header) {\n        return {\n            transactionGetReceipt: {\n                header,\n                transactionID:\n                    this._transactionId != null\n                        ? this._transactionId._toProtobuf()\n                        : null,\n                includeDuplicates: this._includeDuplicates,\n                includeChildReceipts: this._includeChildren,\n            },\n        };\n    }\n\n    /**\n     * @returns {string}\n     */\n    _getLogId() {\n        return `TransactionReceiptQuery:${this._timestamp.toString()}`;\n    }\n}\n\nQUERY_REGISTRY.set(\n    \"transactionGetReceipt\",\n    // eslint-disable-next-line @typescript-eslint/unbound-method\n    TransactionReceiptQuery._fromProtobuf\n);\n"]},"metadata":{},"sourceType":"module"}