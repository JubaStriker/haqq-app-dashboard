{"ast":null,"code":"\"use strict\";\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.createApp = exports.createAppWrapper = exports.createClientApp = exports.WINDOW_UNDEFINED_MESSAGE = void 0;\n\nvar helper_1 = require(\"../actions/helper\");\n\nvar Print_1 = require(\"../actions/Print\");\n\nvar Error_1 = require(\"../actions/Error\");\n\nvar MessageTransport_1 = require(\"../MessageTransport\");\n\nvar shared_1 = require(\"../util/shared\");\n\nvar env_1 = require(\"../util/env\");\n\nvar Client_1 = require(\"../actions/Client\");\n\nvar print_1 = require(\"./print\");\n\nvar redirect_1 = require(\"./redirect\");\n\nvar types_1 = require(\"./types\");\n\nvar Hooks_1 = __importDefault(require(\"./Hooks\"));\n\nexports.WINDOW_UNDEFINED_MESSAGE = 'window is not defined. Running an app outside a browser is not supported';\n\nfunction redirectHandler(hostFrame, config) {\n  var apiKey = config.apiKey,\n      host = config.host,\n      _a = config.forceRedirect,\n      forceRedirect = _a === void 0 ? !env_1.isDevelopmentClient : _a;\n  var location = redirect_1.getLocation();\n\n  if (env_1.isUnframed || !location || !apiKey || !host || !forceRedirect || !redirect_1.shouldRedirect(hostFrame)) {\n    return;\n  }\n\n  var url = \"https://\" + host + \"/apps/\" + apiKey + location.pathname + (location.search || '');\n  redirect_1.redirect(url);\n}\n\nfunction appSetUp(app) {\n  app.subscribe(Print_1.Action.APP, print_1.handleAppPrint);\n  app.dispatch(Client_1.initialize());\n}\n/**\n * @internal\n */\n\n\nexports.createClientApp = function (transport, middlewares) {\n  if (middlewares === void 0) {\n    middlewares = [];\n  }\n\n  var getStateListeners = [];\n  var transportListener = MessageTransport_1.createTransportListener();\n\n  var handler = function (event) {\n    var message = event.data;\n    var type = message.type,\n        payload = message.payload;\n\n    switch (type) {\n      case 'getState':\n        {\n          var resolvers = getStateListeners.splice(0);\n          resolvers.forEach(function (resolver) {\n            return resolver(payload);\n          });\n          break;\n        }\n\n      case 'dispatch':\n        {\n          transportListener.handleMessage(payload);\n          var hasCallback = transportListener.handleActionDispatch(payload);\n\n          if (hasCallback) {\n            return;\n          } // Throw an error if there are no subscriptions to this error\n\n\n          var errorType = helper_1.findMatchInEnum(Error_1.Action, payload.type);\n\n          if (errorType) {\n            Error_1.throwError(errorType, payload);\n          }\n\n          break;\n        }\n\n      default: // Silently swallow unknown actions\n\n    }\n  };\n\n  transport.subscribe(handler);\n  return function (config) {\n    if (!config.host) {\n      throw Error_1.fromAction('host must be provided', Error_1.AppActionType.INVALID_CONFIG);\n    }\n\n    if (!config.apiKey) {\n      throw Error_1.fromAction('apiKey must be provided', Error_1.AppActionType.INVALID_CONFIG);\n    }\n\n    var decodedConfig;\n\n    try {\n      decodedConfig = decodeConfig(config);\n    } catch (_a) {\n      var message = \"not a valid host, please use the value provided by Shopify\";\n      throw Error_1.fromAction(message, Error_1.AppActionType.INVALID_CONFIG);\n    }\n\n    var dispatcher = createDispatcher(transport, decodedConfig);\n    var subscribe = transportListener.createSubscribeHandler(dispatcher); // It is possible to initialize an app multiple times\n    // Therefore we need to clear subscriptions to be safe\n\n    dispatcher(types_1.MessageType.Unsubscribe);\n\n    function dispatch(action) {\n      dispatcher(types_1.MessageType.Dispatch, action);\n      return action;\n    }\n\n    redirectHandler(transport.hostFrame, decodedConfig);\n    var hooks = new Hooks_1.default();\n    var app = {\n      localOrigin: transport.localOrigin,\n      hooks: hooks,\n      dispatch: function (action) {\n        if (!app.hooks) {\n          return dispatch(action);\n        }\n\n        return app.hooks.run(types_1.LifecycleHook.DispatchAction, dispatch, app, action);\n      },\n      featuresAvailable: function (features) {\n        return app.getState('features').then(function (state) {\n          if (features) {\n            Object.keys(state).forEach(function (feature) {\n              if (!features.includes(feature)) {\n                delete state[feature];\n              }\n            });\n          }\n\n          return state;\n        });\n      },\n      getState: function (query) {\n        return new Promise(function (resolve) {\n          getStateListeners.push(resolve);\n          dispatcher(types_1.MessageType.GetState);\n        }).then(function (state) {\n          var newState = state;\n\n          if (query) {\n            return query.split('.').reduce(function (_, key) {\n              if (typeof state !== 'object' || Array.isArray(state)) {\n                return undefined;\n              }\n\n              var stateValue = state[key];\n              newState = state[key];\n              return stateValue;\n            }, undefined);\n          }\n\n          return newState;\n        });\n      },\n      subscribe: subscribe,\n      error: function (listener, id) {\n        var unsubscribeCb = [];\n        helper_1.forEachInEnum(Error_1.Action, function (eventNameSpace) {\n          unsubscribeCb.push(subscribe(eventNameSpace, listener, id));\n        });\n        return function () {\n          unsubscribeCb.forEach(function (unsubscribe) {\n            return unsubscribe();\n          });\n        };\n      }\n    };\n\n    for (var _i = 0, middlewares_1 = middlewares; _i < middlewares_1.length; _i++) {\n      var middleware = middlewares_1[_i];\n      middleware(hooks, app);\n    }\n\n    appSetUp(app);\n    return app;\n  };\n};\n/**\n * @internal\n */\n\n\nfunction decodeConfig(config) {\n  var _a;\n\n  return __assign(__assign({}, config), {\n    host: atob((_a = config.host) === null || _a === void 0 ? void 0 : _a.replace(/_/g, '/').replace(/-/g, '+'))\n  });\n}\n/**\n * @public\n */\n\n\nfunction createAppWrapper(frame, localOrigin, middleware) {\n  if (middleware === void 0) {\n    middleware = [];\n  }\n\n  if (!frame) {\n    throw Error_1.fromAction(exports.WINDOW_UNDEFINED_MESSAGE, Error_1.AppActionType.WINDOW_UNDEFINED);\n  }\n\n  var location = redirect_1.getLocation();\n  var origin = localOrigin || location && location.origin;\n\n  if (!origin) {\n    throw Error_1.fromAction('local origin cannot be blank', Error_1.AppActionType.MISSING_LOCAL_ORIGIN);\n  }\n\n  var transport = MessageTransport_1.fromWindow(frame, origin);\n  var appCreator = exports.createClientApp(transport, middleware);\n  return appCreator;\n}\n\nexports.createAppWrapper = createAppWrapper;\n/**\n * Creates your application instance.\n * @param config - `apiKey` and `host` are both required.\n * @remarks\n * You will need to store `host` during the authentication process and then retrieve it for the code to work properly. To learn more about this process, see {@link https://help.shopify.com/api/embedded-apps/shop-origin | Getting and storing the shop origin}.\n * @public\n */\n\nfunction createApp(config) {\n  var currentWindow = redirect_1.getWindow();\n\n  if (!currentWindow) {\n    return shared_1.serverAppBridge;\n  }\n\n  return createAppWrapper(currentWindow.top)(config);\n}\n\nexports.createApp = createApp;\n\nfunction createDispatcher(transport, config) {\n  return function (type, payload) {\n    transport.dispatch({\n      payload: payload,\n      source: config,\n      type: type\n    });\n  };\n}\n/**\n * {@inheritdocs createApp}\n * @public\n */\n\n\nexports.default = createApp;","map":{"version":3,"sources":["/Users/jithendra/Desktop/Work/hbar-shop/xrp-shopify-coupon-client/node_modules/@shopify/app-bridge/client/Client.js"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","__importDefault","mod","__esModule","defineProperty","exports","value","createApp","createAppWrapper","createClientApp","WINDOW_UNDEFINED_MESSAGE","helper_1","require","Print_1","Error_1","MessageTransport_1","shared_1","env_1","Client_1","print_1","redirect_1","types_1","Hooks_1","redirectHandler","hostFrame","config","apiKey","host","_a","forceRedirect","isDevelopmentClient","location","getLocation","isUnframed","shouldRedirect","url","pathname","search","redirect","appSetUp","app","subscribe","Action","APP","handleAppPrint","dispatch","initialize","transport","middlewares","getStateListeners","transportListener","createTransportListener","handler","event","message","data","type","payload","resolvers","splice","forEach","resolver","handleMessage","hasCallback","handleActionDispatch","errorType","findMatchInEnum","throwError","fromAction","AppActionType","INVALID_CONFIG","decodedConfig","decodeConfig","dispatcher","createDispatcher","createSubscribeHandler","MessageType","Unsubscribe","action","Dispatch","hooks","default","localOrigin","run","LifecycleHook","DispatchAction","featuresAvailable","features","getState","then","state","keys","feature","includes","query","Promise","resolve","push","GetState","newState","split","reduce","_","key","Array","isArray","undefined","stateValue","error","listener","id","unsubscribeCb","forEachInEnum","eventNameSpace","unsubscribe","_i","middlewares_1","middleware","atob","replace","frame","WINDOW_UNDEFINED","origin","MISSING_LOCAL_ORIGIN","fromWindow","appCreator","currentWindow","getWindow","serverAppBridge","top","source"],"mappings":"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","sourcesContent":["\"use strict\";\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.createApp = exports.createAppWrapper = exports.createClientApp = exports.WINDOW_UNDEFINED_MESSAGE = void 0;\nvar helper_1 = require(\"../actions/helper\");\nvar Print_1 = require(\"../actions/Print\");\nvar Error_1 = require(\"../actions/Error\");\nvar MessageTransport_1 = require(\"../MessageTransport\");\nvar shared_1 = require(\"../util/shared\");\nvar env_1 = require(\"../util/env\");\nvar Client_1 = require(\"../actions/Client\");\nvar print_1 = require(\"./print\");\nvar redirect_1 = require(\"./redirect\");\nvar types_1 = require(\"./types\");\nvar Hooks_1 = __importDefault(require(\"./Hooks\"));\nexports.WINDOW_UNDEFINED_MESSAGE = 'window is not defined. Running an app outside a browser is not supported';\nfunction redirectHandler(hostFrame, config) {\n    var apiKey = config.apiKey, host = config.host, _a = config.forceRedirect, forceRedirect = _a === void 0 ? !env_1.isDevelopmentClient : _a;\n    var location = redirect_1.getLocation();\n    if (env_1.isUnframed || !location || !apiKey || !host || !forceRedirect || !redirect_1.shouldRedirect(hostFrame)) {\n        return;\n    }\n    var url = \"https://\" + host + \"/apps/\" + apiKey + location.pathname + (location.search || '');\n    redirect_1.redirect(url);\n}\nfunction appSetUp(app) {\n    app.subscribe(Print_1.Action.APP, print_1.handleAppPrint);\n    app.dispatch(Client_1.initialize());\n}\n/**\n * @internal\n */\nexports.createClientApp = function (transport, middlewares) {\n    if (middlewares === void 0) { middlewares = []; }\n    var getStateListeners = [];\n    var transportListener = MessageTransport_1.createTransportListener();\n    var handler = function (event) {\n        var message = event.data;\n        var type = message.type, payload = message.payload;\n        switch (type) {\n            case 'getState': {\n                var resolvers = getStateListeners.splice(0);\n                resolvers.forEach(function (resolver) { return resolver(payload); });\n                break;\n            }\n            case 'dispatch': {\n                transportListener.handleMessage(payload);\n                var hasCallback = transportListener.handleActionDispatch(payload);\n                if (hasCallback) {\n                    return;\n                }\n                // Throw an error if there are no subscriptions to this error\n                var errorType = helper_1.findMatchInEnum(Error_1.Action, payload.type);\n                if (errorType) {\n                    Error_1.throwError(errorType, payload);\n                }\n                break;\n            }\n            default:\n            // Silently swallow unknown actions\n        }\n    };\n    transport.subscribe(handler);\n    return function (config) {\n        if (!config.host) {\n            throw Error_1.fromAction('host must be provided', Error_1.AppActionType.INVALID_CONFIG);\n        }\n        if (!config.apiKey) {\n            throw Error_1.fromAction('apiKey must be provided', Error_1.AppActionType.INVALID_CONFIG);\n        }\n        var decodedConfig;\n        try {\n            decodedConfig = decodeConfig(config);\n        }\n        catch (_a) {\n            var message = \"not a valid host, please use the value provided by Shopify\";\n            throw Error_1.fromAction(message, Error_1.AppActionType.INVALID_CONFIG);\n        }\n        var dispatcher = createDispatcher(transport, decodedConfig);\n        var subscribe = transportListener.createSubscribeHandler(dispatcher);\n        // It is possible to initialize an app multiple times\n        // Therefore we need to clear subscriptions to be safe\n        dispatcher(types_1.MessageType.Unsubscribe);\n        function dispatch(action) {\n            dispatcher(types_1.MessageType.Dispatch, action);\n            return action;\n        }\n        redirectHandler(transport.hostFrame, decodedConfig);\n        var hooks = new Hooks_1.default();\n        var app = {\n            localOrigin: transport.localOrigin,\n            hooks: hooks,\n            dispatch: function (action) {\n                if (!app.hooks) {\n                    return dispatch(action);\n                }\n                return app.hooks.run(types_1.LifecycleHook.DispatchAction, dispatch, app, action);\n            },\n            featuresAvailable: function (features) {\n                return app.getState('features').then(function (state) {\n                    if (features) {\n                        Object.keys(state).forEach(function (feature) {\n                            if (!features.includes(feature)) {\n                                delete state[feature];\n                            }\n                        });\n                    }\n                    return state;\n                });\n            },\n            getState: function (query) {\n                return new Promise(function (resolve) {\n                    getStateListeners.push(resolve);\n                    dispatcher(types_1.MessageType.GetState);\n                }).then(function (state) {\n                    var newState = state;\n                    if (query) {\n                        return query.split('.').reduce(function (_, key) {\n                            if (typeof state !== 'object' || Array.isArray(state)) {\n                                return undefined;\n                            }\n                            var stateValue = state[key];\n                            newState = state[key];\n                            return stateValue;\n                        }, undefined);\n                    }\n                    return newState;\n                });\n            },\n            subscribe: subscribe,\n            error: function (listener, id) {\n                var unsubscribeCb = [];\n                helper_1.forEachInEnum(Error_1.Action, function (eventNameSpace) {\n                    unsubscribeCb.push(subscribe(eventNameSpace, listener, id));\n                });\n                return function () {\n                    unsubscribeCb.forEach(function (unsubscribe) { return unsubscribe(); });\n                };\n            },\n        };\n        for (var _i = 0, middlewares_1 = middlewares; _i < middlewares_1.length; _i++) {\n            var middleware = middlewares_1[_i];\n            middleware(hooks, app);\n        }\n        appSetUp(app);\n        return app;\n    };\n};\n/**\n * @internal\n */\nfunction decodeConfig(config) {\n    var _a;\n    return __assign(__assign({}, config), { host: atob((_a = config.host) === null || _a === void 0 ? void 0 : _a.replace(/_/g, '/').replace(/-/g, '+')) });\n}\n/**\n * @public\n */\nfunction createAppWrapper(frame, localOrigin, middleware) {\n    if (middleware === void 0) { middleware = []; }\n    if (!frame) {\n        throw Error_1.fromAction(exports.WINDOW_UNDEFINED_MESSAGE, Error_1.AppActionType.WINDOW_UNDEFINED);\n    }\n    var location = redirect_1.getLocation();\n    var origin = localOrigin || (location && location.origin);\n    if (!origin) {\n        throw Error_1.fromAction('local origin cannot be blank', Error_1.AppActionType.MISSING_LOCAL_ORIGIN);\n    }\n    var transport = MessageTransport_1.fromWindow(frame, origin);\n    var appCreator = exports.createClientApp(transport, middleware);\n    return appCreator;\n}\nexports.createAppWrapper = createAppWrapper;\n/**\n * Creates your application instance.\n * @param config - `apiKey` and `host` are both required.\n * @remarks\n * You will need to store `host` during the authentication process and then retrieve it for the code to work properly. To learn more about this process, see {@link https://help.shopify.com/api/embedded-apps/shop-origin | Getting and storing the shop origin}.\n * @public\n */\nfunction createApp(config) {\n    var currentWindow = redirect_1.getWindow();\n    if (!currentWindow) {\n        return shared_1.serverAppBridge;\n    }\n    return createAppWrapper(currentWindow.top)(config);\n}\nexports.createApp = createApp;\nfunction createDispatcher(transport, config) {\n    return function (type, payload) {\n        transport.dispatch({\n            payload: payload,\n            source: config,\n            type: type,\n        });\n    };\n}\n/**\n * {@inheritdocs createApp}\n * @public\n */\nexports.default = createApp;\n"]},"metadata":{},"sourceType":"script"}